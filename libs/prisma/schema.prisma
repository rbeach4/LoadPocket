generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  DISPATCHER
  ACCOUNTING
}

enum LoadStatus {
  QUOTED
  BOOKED
  DISPATCHED
  IN_TRANSIT
  DELIVERED
  INVOICED
  PAID
  CANCELLED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  VOID
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  role      UserRole @default(DISPATCHER)
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  loads     Load[]
  invoices  Invoice[]

  @@map("users")
}

model Customer {
  id           String   @id @default(cuid())
  name         String
  email        String?
  phone        String?
  address      String?
  city         String?
  state        String?
  zip          String?
  contactName  String?  @map("contact_name")
  notes        String?
  creditLimit  Decimal? @db.Decimal(10, 2) @map("credit_limit")
  paymentTerms Int      @default(30) @map("payment_terms")
  active       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  loads    Load[]
  invoices Invoice[]

  @@map("customers")
}

model Carrier {
  id            String    @id @default(cuid())
  name          String
  mcNumber      String?   @unique @map("mc_number")
  dotNumber     String?   @unique @map("dot_number")
  email         String?
  phone         String?
  address       String?
  city          String?
  state         String?
  zip           String?
  contactName   String?   @map("contact_name")
  notes         String?
  insuranceExp  DateTime? @map("insurance_exp")
  active        Boolean   @default(true)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  loads Load[]

  @@map("carriers")
}

model Load {
  id              String     @id @default(cuid())
  loadNumber      String     @unique @map("load_number")
  status          LoadStatus @default(QUOTED)
  
  originAddress   String     @map("origin_address")
  originCity      String     @map("origin_city")
  originState     String     @map("origin_state")
  originZip       String     @map("origin_zip")
  pickupDate      DateTime?  @map("pickup_date")
  pickupTime      String?    @map("pickup_time")
  
  destAddress     String     @map("dest_address")
  destCity        String     @map("dest_city")
  destState       String     @map("dest_state")
  destZip         String     @map("dest_zip")
  deliveryDate    DateTime?  @map("delivery_date")
  deliveryTime    String?    @map("delivery_time")
  
  customerRate    Decimal    @db.Decimal(10, 2) @map("customer_rate")
  carrierRate     Decimal    @db.Decimal(10, 2) @map("carrier_rate")
  margin          Decimal    @db.Decimal(10, 2)
  
  weight          Decimal?   @db.Decimal(10, 2)
  pieces          Int?
  commodity       String?
  equipment       String?
  notes           String?
  
  customerId      String     @map("customer_id")
  customer        Customer   @relation(fields: [customerId], references: [id])
  
  carrierId       String?    @map("carrier_id")
  carrier         Carrier?   @relation(fields: [carrierId], references: [id])
  
  dispatcherId    String?    @map("dispatcher_id")
  dispatcher      User?      @relation(fields: [dispatcherId], references: [id])
  
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")

  documents Document[]
  invoice   Invoice?

  @@map("loads")
}

model Document {
  id        String   @id @default(cuid())
  name      String
  type      String
  url       String
  loadId    String   @map("load_id")
  load      Load     @relation(fields: [loadId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("documents")
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique @map("invoice_number")
  status        InvoiceStatus @default(DRAFT)
  amount        Decimal       @db.Decimal(10, 2)
  dueDate       DateTime      @map("due_date")
  paidDate      DateTime?     @map("paid_date")
  notes         String?
  
  customerId    String        @map("customer_id")
  customer      Customer      @relation(fields: [customerId], references: [id])
  
  loadId        String        @unique @map("load_id")
  load          Load          @relation(fields: [loadId], references: [id])
  
  createdById   String        @map("created_by_id")
  createdBy     User          @relation(fields: [createdById], references: [id])
  
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  @@map("invoices")
}
